<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>護理排班系統</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand__logo">NS</div>
        <div class="brand__text">
          <div class="brand__title">護理排班系統</div>
          <div class="brand__sub">v1 原型</div>
        </div>
      </div>

      <nav class="nav">
        <button class="nav__item is-active" data-view="calendar">
          <span class="nav__label">排班總覽</span>
        </button>
        <button class="nav__item" data-view="rules">
          <span class="nav__label">規則維護</span>
        </button>
        <button class="nav__item" data-view="master">
          <span class="nav__label">資料維護</span>
        </button>
        <button class="nav__item" data-view="opt">
          <span class="nav__label">最佳化</span>
        </button>
        <button class="nav__item" data-view="dsl">
          <span class="nav__label">DSL 測試台</span>
        </button>
      </nav>

      <div class="sidebar__footer">
        <div class="pill" id="projectPill">載入中…</div>
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="topbar__left">
          <h1 id="viewTitle">排班總覽</h1>
          <div class="muted" id="viewSub">週檢視（v1）</div>
        </div>
        <div class="topbar__right">
          <button class="btn" id="btnRefresh">重新整理</button>
        </div>
      </header>

      <section class="content">
        <!-- Calendar -->
        <div class="view" id="view-calendar">
          <div class="card">
            <div class="card__hd">
              <div class="card__title">排班表</div>
              <div class="card__actions">
                <label class="field">
                  <span>起始日</span>
                  <input type="date" id="calStart" />
                </label>
                <button class="btn btn--primary" id="btnLoadCalendar">載入</button>
              </div>
            </div>
            <div class="card__bd">
              <div class="calendar" id="calendarGrid"></div>
            </div>
            <div class="card__ft">
              <div class="muted">點選格子可編輯班別與備註。v1 以 7 天週檢視呈現。</div>
            </div>
          </div>
        </div>

        <!-- Rules -->
        <div class="view is-hidden" id="view-rules">
          <div class="grid2">
            <div class="card">
              <div class="card__hd">
                <div class="card__title">自然語言 → DSL（Streaming）</div>
              </div>
              <div class="card__bd">
                <label class="field full">
                  <span>規則描述（自然語言）</span>
                  <textarea id="nlInput" rows="5" placeholder="例如：急診白班每天至少 2 人，大夜連續最多 2 天。"></textarea>
                </label>
                <div class="row">
                  <button class="btn btn--primary" id="btnNlToDsl">轉換（SSE）</button>
                  <button class="btn" id="btnSaveRule">存成規則</button>
                </div>
                <div class="muted" id="nlStatus"></div>
              </div>
            </div>

            <div class="card">
              <div class="card__hd">
                <div class="card__title">DSL</div>
                <div class="card__actions">
                  <button class="btn" id="btnValidate">驗證</button>
                  <button class="btn" id="btnDslToNl">反向翻譯</button>
                </div>
              </div>
              <div class="card__bd">
                <textarea id="dslOutput" rows="14" placeholder="這裡會即時輸出 DSL"></textarea>
                <div class="muted" id="dslStatus"></div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top: 14px;">
            <div class="card__hd">
              <div class="card__title">規則列表</div>
              <div class="card__actions">
                <button class="btn" id="btnReloadRules">重新載入</button>
              </div>
            </div>
            <div class="card__bd">
              <table class="table" id="rulesTable">
                <thead>
                  <tr>
                    <th>標題</th>
                    <th>啟用</th>
                    <th>更新時間</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Master -->
        <div class="view is-hidden" id="view-master">
          <div class="tabs">
            <button class="tab is-active" data-tab="nurses">護理師</button>
            <button class="tab" data-tab="departments">科別</button>
            <button class="tab" data-tab="shift">班別</button>
            <button class="tab" data-tab="levels">職級</button>
            <button class="tab" data-tab="skills">技能</button>
          </div>
          <div class="card">
            <div class="card__hd">
              <div class="card__title" id="masterTitle">護理師</div>
              <div class="card__actions">
                <button class="btn btn--primary" id="btnAddMaster">新增</button>
                <button class="btn" id="btnReloadMaster">重新載入</button>
              </div>
            </div>
            <div class="card__bd">
              <div id="masterTableWrap"></div>
            </div>
          </div>
        </div>

        <!-- Optimization -->
        <div class="view is-hidden" id="view-opt">
          <div class="grid2">
            <div class="card">
              <div class="card__hd">
                <div class="card__title">建立最佳化任務</div>
              </div>
              <div class="card__bd">
                <label class="field full">
                  <span>目標（可空，v1 mock）</span>
                  <textarea id="optGoal" rows="4" placeholder="例如：盡量平均夜班，滿足每日人力下限。"></textarea>
                </label>
                <button class="btn btn--primary" id="btnCreateJob">建立並執行（SSE）</button>
                <div class="muted" id="optStatus"></div>
                <div class="progress">
                  <div class="progress__bar" id="optBar" style="width:0%"></div>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="card__hd">
                <div class="card__title">執行紀錄</div>
              </div>
              <div class="card__bd">
                <div class="log" id="optLog"></div>
              </div>
            </div>
          </div>
          <div class="card" style="margin-top:14px;">
            <div class="card__hd">
              <div class="card__title">Job 列表</div>
              <div class="card__actions">
                <button class="btn" id="btnReloadJobs">重新載入</button>
              </div>
            </div>
            <div class="card__bd">
              <table class="table" id="jobsTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>狀態</th>
                    <th>進度</th>
                    <th>更新時間</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- DSL Tester -->
        <div class="view is-hidden" id="view-dsl">
          <div class="card">
            <div class="card__hd">
              <div class="card__title">DSL 驗證器</div>
              <div class="card__actions">
                <button class="btn btn--primary" id="btnDslValidateOnly">驗證</button>
              </div>
            </div>
            <div class="card__bd">
              <textarea id="dslTester" rows="18" placeholder="貼上 DSL（JSON）"></textarea>
              <div class="muted" id="dslTesterStatus"></div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- modal -->
  <div class="modal is-hidden" id="modal">
    <div class="modal__panel">
      <div class="modal__hd">
        <div class="modal__title" id="modalTitle">編輯</div>
        <button class="iconbtn" id="modalClose">×</button>
      </div>
      <div class="modal__bd" id="modalBody"></div>
      <div class="modal__ft">
        <button class="btn" id="modalCancel">取消</button>
        <button class="btn btn--primary" id="modalOk">確定</button>
      </div>
    </div>
  </div>

  <div id="toast" aria-live="polite"></div>

  <script src="/static/app.js"></script>
</body>
</html>
